CREATE OR REPLACE VIEW V_CAPTAIN_PRODUCTIVITY AS
SELECT
    C.CAPTAIN_ID,
    C.NAME,
    C.CITY,
    COUNT(R.RIDE_ID) AS TOTAL_RIDES,
    SUM(CASE WHEN R.STATUS = 'Completed' THEN 1 ELSE 0 END) AS COMPLETED_RIDES,
    ROUND(AVG(R.RATING), 2) AS AVG_RATING,
    SUM(R.EARNINGS) AS TOTAL_EARNINGS,
    L.HOURS_ACTIVE
FROM CAPTAINS C, RIDES R, LOGIN_DETAILS L
WHERE C.CAPTAIN_ID =  R.CAPTAIN_ID
AND C.CAPTAIN_ID =  L.CAPTAIN_ID
GROUP BY  C.CAPTAIN_ID, C.NAME, C.CITY, L.HOURS_ACTIVE;