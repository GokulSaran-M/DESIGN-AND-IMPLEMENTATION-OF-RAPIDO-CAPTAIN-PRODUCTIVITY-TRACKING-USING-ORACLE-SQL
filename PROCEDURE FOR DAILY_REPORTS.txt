CREATE OR REPLACE PROCEDURE GENERATE_DAILY_RAPIDO_REPORT 
IS
BEGIN
    INSERT INTO DAILY_REPORTS (REPORT_DATE, CAPTAIN_ID, TOTAL_RIDES, RIDES_COMPLETED, HOURS_ACTIVE, AVG_RATING, TOTAL_EARNINGS)
    SELECT
        TRUNC(SYSDATE),
        R.CAPTAIN_ID,
        COUNT(R.RIDE_ID),
        COUNT(CASE WHEN R.STATUS = 'Completed' THEN 1 END),
        L.HOURS_ACTIVE,
        ROUND(AVG(R.RATING), 2),
        SUM(R.EARNINGS)
    FROM RIDES R, LOGIN_DETAILS L
    WHERE R.CAPTAIN_ID = L.CAPTAIN_ID AND R.RIDE_DATE = L.SESSION_DATE
    AND R.RIDE_DATE = TRUNC(SYSDATE)
    GROUP BY R.CAPTAIN_ID, L.HOURS_ACTIVE;

    COMMIT;
END;